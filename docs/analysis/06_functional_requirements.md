# Functional Requirements (FRs) - Software Requirements Specification (SRS)

This document details the functional capabilities of The Meridian Grid platform, derived from the User Stories and adhering to a formal Software Requirements Specification structure. All requirements follow a global numbering sequence (FR-01 onwards).

---

## 1. Core & Connectivity (Epic 1)

| ID        | Description                                                                                                                       | Origin Story             | Inputs                                                                                          | Processing                                                                                          | Outputs                                                                  | MoSCoW |
| :-------- | :-------------------------------------------------------------------------------------------------------------------------------- | :----------------------- | :---------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------- | :----- |
| **FR-01** | The system shall store digital twin definitions (Asset Administration Shell / DTDL models) in a flexible, schema-less format.     | [[CORE-01]]              | JSON-formatted DTDL model from Device Integrator.                                               | Validate JSON structure; store in PostgreSQL JSONB column.                                          | Unique Asset Identity (ID); stored digital twin model.                   | MUST   |
| **FR-02** | The system shall prevent the creation of Digital Assets with non-unique names.                                                    | [[CORE-01]]              | Proposed asset name.                                                                            | Check database for existing asset names.                                                            | Error message on duplicate name; successful creation otherwise.          | MUST   |
| **FR-03** | The system shall ingest real-time MQTT messages and parse their payloads.                                                         | [[CORE-02]]              | Raw MQTT message (topic, payload) from message broker.                                          | Subscribe to configured MQTT topics; receive and buffer messages.                                   | Buffered MQTT message.                                                   | MUST   |
| **FR-04** | The system shall map ingested MQTT payload values to specific properties of a Digital Asset using defined JSONPath expressions.   | [[CORE-02]]              | Buffered MQTT message, asset configuration (JSONPath mappings).                                 | Extract values from payload using JSONPath; validate data types against asset property definitions. | Mapped telemetry data point (asset ID, property name, value, timestamp). | MUST   |
| **FR-05** | The system shall store mapped telemetry data points in a time-series optimized database.                                          | [[CORE-02]]              | Mapped telemetry data point.                                                                    | Insert data into TimescaleDB hypertable.                                                            | Stored time-series record.                                               | MUST   |
| **FR-06** | The system shall store arbitrary key-value metadata (e.g., Serial Number, Manufacturer) for each Digital Asset.                   | [[CORE-04]]              | Metadata key-value pairs.                                                                       | Store in PostgreSQL JSONB column associated with the asset.                                         | Stored metadata accessible via asset ID.                                 | MUST   |
| **FR-07** | The system shall allow Device Integrators to define threshold-based rules on asset telemetry data.                                | [[CORE-05]], [[AUTO-32]] | Rule expression (e.g., `Boiler_01.Pressure > 120`), associated asset property, threshold value. | Validate rule syntax; store rule definition.                                                        | Stored rule definition.                                                  | MUST   |
| **FR-08** | The system shall evaluate an asset's operational status (Healthy, Warning, Critical) based on active rules and current telemetry. | [[CORE-05]]              | Asset telemetry, active rule definitions.                                                       | Continuously evaluate rules against incoming telemetry; determine the most severe status.           | Updated asset status.                                                    | MUST   |
| **FR-09** | The system shall allow System Administrators to assign granular access permissions to users or roles at the asset level.          | [[CORE-07]], [[IAM-13]]  | User/Role ID, Asset ID, permission type (Read, Write, Execute).                                 | Store permission assignments in a dedicated access control list (ACL) table.                        | Stored access permission record.                                         | MUST   |
| **FR-10** | The system shall manage the lifecycle state of a Digital Asset (Draft, Active, Archived).                                         | [[CORE-09]]              | Asset ID, desired state (Draft/Active/Archived).                                                | Update asset state; enable/disable telemetry ingestion and rule evaluation based on state.          | Updated asset state.                                                     | MUST   |
| **FR-11** | The system shall automatically enforce configured data retention policies for telemetry data.                                     | [[CORE-42]]              | Configured retention period per data type.                                                      | Periodically delete or aggregate telemetry data older than the specified retention period.          | Removed/aggregated historical data.                                      | MUST   |

---

## 2. Identity, Access & Role Management (Epic 2)

| ID        | Description                                                                                                                                                                         | Origin Story | Inputs                                                                    | Processing                                                                                                       | Outputs                                                                  | MoSCoW |
| :-------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------- | :------------------------------------------------------------------------ | :--------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------- | :----- |
| **FR-12** | The system shall allow System Administrators to create, read, update, and disable user accounts.                                                                                    | [[IAM-11]]   | User details (email, name, password, etc.), user ID for updates/disables. | Validate inputs; hash passwords; store/retrieve user records.                                                    | New user account, updated user details, disabled user status, user list. | MUST   |
| **FR-13** | The system shall allow System Administrators to assign predefined roles (Administrator, Integrator, Operator, Viewer) to user accounts.                                             | [[IAM-12]]   | User ID, Role ID.                                                         | Update user's role assignment in the database.                                                                   | Updated user role.                                                       | MUST   |
| **FR-14** | The system shall authenticate users securely using hashed passwords and manage session validity.                                                                                    | [[IAM-14]]   | User email, password.                                                     | Retrieve user record; hash input password and compare; generate/validate secure session token (HttpOnly cookie). | Authenticated user session, redirection to dashboard or error message.   | MUST   |
| **FR-15** | The system shall invalidate a user's session upon explicit logout.                                                                                                                  | [[IAM-14]]   | Logout request.                                                           | Clear server-side session data; remove client-side session cookie.                                               | Redirect to login page.                                                  | MUST   |
| **FR-16** | The system shall immutably log critical user actions (e.g., login, asset creation, permission changes) with relevant details.                                                       | [[IAM-18]]   | User ID, action type, timestamp, IP address, affected resource ID.        | Record audit event in a dedicated, append-only log table.                                                        | Stored audit log entry.                                                  | MUST   |
| **FR-17** | The system shall provide a "Developer Mode" that, during initial setup or via configuration, automatically grants full administrative and integration permissions to a single user. | [[IAM-21]]   | Environment variable or first-run wizard selection.                       | Assigns "SuperAdmin" role to the initial user; bypasses certain scope checks.                                    | User with elevated permissions; visual indicator of Developer Mode.      | MUST   |

---

## 3. Composable HMI & Visualization Framework (Epic 3) 

| ID | Description | Origin Story | Inputs | Processing | Outputs | MoSCoW |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **FR-18** | The system shall allow Device Integrators to create, rename, duplicate, and delete dashboards. | [[HMI-22]] | Dashboard name, ID. | Store dashboard configuration (JSON) in the database. | New dashboard, updated dashboard name, deleted dashboard. | MUST |
| **FR-19** | The system shall enable Device Integrators to arrange and resize dashboard widgets using drag-and-drop functionality on a grid. | [[HMI-23]] | Widget ID, new (x, y, width, height) coordinates. | Update dashboard JSON configuration with new widget layout. | Visually updated dashboard layout. | MUST |
| **FR-20** | The system shall provide a library of standard visualization widgets including Time-series Line Charts, Radial Gauges, and Numeric Displays. | [[HMI-24]] | Widget type selection. | Instantiate selected widget with default properties. | New empty widget on the dashboard. | MUST |
| **FR-21** | The system shall allow Device Integrators to bind a widget's data input to a specific property of a Semantic Asset. | [[HMI-25]] | Widget ID, Asset ID, property name. | Store binding configuration within the widget's properties in the dashboard JSON. | Widget configured to display data from the bound source. | MUST |
| **FR-22** | The system shall push real-time telemetry updates to active dashboard widgets via WebSockets. | [[HMI-26]] | Mapped telemetry data points (from CORE-02). | Backend pushes updates to connected frontend clients; frontend updates relevant widgets. | Live-updating dashboard widgets. | MUST |
| **FR-23** | The system shall retrieve and display historical telemetry data for specified time ranges. | [[HMI-27]] | Asset ID, property name, start timestamp, end timestamp. | Query TimescaleDB for data within the range; aggregate if necessary. | Chart/table display of historical data. | MUST |

---

## 4. Intelligent Automation & Control Assurance (Epic 4)

| ID | Description | Origin Story | Inputs | Processing | Outputs | MoSCoW |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **FR-24** | The system shall continuously evaluate defined rules (e.g., `Asset.Property > Value`) against incoming telemetry data. | [[AUTO-32]] | Incoming telemetry data, active rule definitions. | Execute rule expressions; detect condition breaches. | Rule breach event. | MUST |
| **FR-25** | The system shall create a new Alert Instance in response to a rule condition breach. | [[AUTO-33]] | Rule breach event (asset ID, property, value, timestamp, rule ID). | Create a new record in the Alerts table with "New" status, severity. | Stored Alert Instance. | MUST |
| **FR-26** | The system shall prevent the creation of duplicate active alerts for the same condition on the same asset. | [[AUTO-33]] | New rule breach event. | Check for existing "New" or "Acknowledged" alerts for the same condition. | Update "Last Seen" timestamp of existing alert, or create new alert if unique. | MUST |
| **FR-27** | The system shall allow Operators to acknowledge active alerts. | [[AUTO-35]] | Alert ID, User ID (acknowledging operator). | Update alert status to "Acknowledged"; record timestamp and user. | Updated alert status. | MUST |
| **FR-28** | The system shall evaluate defined safety interlock conditions before executing any automated control command. | [[AUTO-37]] | Proposed control command, current state of relevant assets (interlock conditions). | Execute interlock logic; determine if the command is safe to proceed. | "Safe to Proceed" signal, or "Interlock Breach" signal. | MUST |
| **FR-29** | The system shall notify System Administrators of any blocked automated control commands due to safety interlock breaches. | [[AUTO-37]] | "Interlock Breach" signal. | Create a Critical Alert; send notifications via configured channels. | Alert notification. | MUST 
